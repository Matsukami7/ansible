- hosts: all
  become: yes
  tasks:
    # Update apt cache
    - name: Update apt cache
      apt:
        update_cache: yes

    # Install Neofetch
    - name: Install Neofetch
      apt:
        name: neofetch
        state: present

    # Ensure Neofetch runs on startup for "root" and "narokuu"
    - name: Ensure Neofetch runs on startup for each user
      lineinfile:
        path: "{{ item }}/.bashrc"
        line: "neofetch"
        state: present
        create: yes
      with_items:
        - /root
        - /home/narokuu
      become: yes

    # Ensure Neofetch config directory exists for "root" and "narokuu"
    - name: Ensure Neofetch config directory exists for each user
      file:
        path: "{{ item }}/.config/neofetch"
        state: directory
        owner: "{{ item | regex_replace('/home/', '') | regex_replace('/root', 'root') }}"
        group: "{{ item | regex_replace('/home/', '') | regex_replace('/root', 'root') }}"
        mode: '0755'
      with_items:
        - /root
        - /home/narokuu
      become: yes

    # Create or update Neofetch config file for "root" and "narokuu"
    - name: Create or update Neofetch config file for each user
      copy:
        dest: "{{ item }}/.config/neofetch/config.conf"
        content: |
          # Neofetch configuration file
          # See https://github.com/dylanaraps/neofetch/wiki/Customizing-Info for customization options

          # Default display options
          print_info() {
            info title
            info underline
            info "OS" distro
            info "Kernel" kernel
            info "Uptime" uptime
            info "Packages" packages
            info "Shell" shell
            info "Resolution" resolution
            info "DE" de
            info "WM" wm
            info "Theme" theme
            info "Icons" icons
            info "Terminal" term
            info "CPU" cpu
            info "Memory" memory
            info "Disk" disk
            info "IP Address" ip
          }
        owner: "{{ item | regex_replace('/home/', '') | regex_replace('/root', 'root') }}"
        group: "{{ item | regex_replace('/home/', '') | regex_replace('/root', 'root') }}"
        mode: '0644'
      with_items:
        - /root
        - /home/narokuu
      become: yes